## 1) Maven 명령어 인식 불가 (`mvn: command not found`)

- **증상**
  - PowerShell에서 `mvn clean compile` 실행 시  
    `mvn : 'mvn' 는 ... 명령으로 인식되지 않습니다` 오류 발생.
- **원인 가설**
  - 로컬 환경에 Maven 설치가 되어 있지 않거나, `PATH`에 Maven `bin` 경로가 잡혀 있지 않음.
- **조치 내용**
  - 과제 코드/구조 설계는 그대로 진행하되,
  - 실제 빌드·실행은 사용자의 로컬 환경에서 Maven 설치 후 진행하도록 **README/DEPLOYMENT에 명시**.
- **결과**
  - 코드/테스트/문서 수준에서는 Maven 의존성·구조 일관성을 유지하고,
  - 빌드 환경 문제는 "실행 환경 이슈"로 분리하여 코드 품질과 구분.

---

## 2) 잘못된 JSON 요청에 대해 500이 반환되던 문제

- **증상**
  - 테스트 `OpportunityCostControllerTest.testCalculate_InvalidJson`에서  
    `{ invalid json }` 요청에 대해 기대 상태 코드 400이 아닌 500이 반환되며 테스트 실패.
- **원인 가설**
  - `HttpMessageNotReadableException`이 전역 예외 처리기에서 `Exception` 핸들러에 의해 500으로 처리되고 있음.
- **조치 내용**
  - `GlobalExceptionHandler`에 `@ExceptionHandler(HttpMessageNotReadableException.class)` 추가.
  - 잘못된 JSON 요청 시 400 Bad Request + "요청 형식이 올바르지 않습니다." 메시지를 반환하도록 수정.
- **결과**
  - 해당 테스트가 기대대로 400을 받고 통과.
  - API 사용자가 "클라이언트 잘못 vs 서버 오류"를 더 명확히 구분할 수 있게 됨.

---

## 3) 서비스 생성자 변경으로 인한 테스트 코드 실패

- **증상**
  - `OpportunityCostService`에 `CalculationCacheService`가 생성자 주입으로 추가된 이후,
  - 기존 테스트 `new OpportunityCostService()` 코드가 더 이상 컴파일되지 않음.
- **원인 가설**
  - 서비스 의존성 추가 후 테스트 코드가 함께 리팩터링되지 않음.
- **조치 내용**
  - 테스트 `OpportunityCostServiceTest.setUp()`에서  
    `CalculationCacheService`를 직접 생성하여 `new OpportunityCostService(cacheService)`로 주입.
- **결과**
  - 기존 테스트 케이스(기본 계산, 동일 총비용, 0분/0원, floor 처리 등)가 모두 다시 통과.

---

## 4) 프론트엔드 계산 버튼 로직 중복 및 잠재적 버그

- **증상**
  - `calculateBtn`에 대한 이벤트 핸들러가 여러 번 정의되면서,
  - 다안 비교 모드/2안 비교 모드 전환 시 어떤 로직이 호출되는지 한눈에 파악하기 어려움.
- **원인 가설**
  - 초기 구현(2안 비교) 위에 다안 비교 기능을 얹으면서, 기존 핸들러를 제거하지 않고 추가로 덧씌움.
- **조치 내용**
  - 2안 비교 로직을 `calculateTwoOptions()` 함수로 분리.
  - 다안 비교는 `calculateMulti()`로 유지하되,
  - `calculateBtn` 클릭 시 `currentMode`에 따라 두 함수 중 하나만 호출하도록 단일 핸들러로 정리.
- **결과**
  - 모드 전환과 관계없이 한 번의 클릭에 한 번의 API 호출만 일어나도록 보장.
  - 히스토리 저장 로직도 각 함수 내부에서 일관되게 처리.

---

## 5) 커밋 메시지 vs 문서화 전략 정리 필요

- **증상**
  - 커밋 메시지에 상세 내역을 담으려다 보면,
  - 과제에서 요구하는 "개선 과정 기록"을 어디서 어떻게 보는 게 맞는지 모호해질 수 있음.
- **원인 가설**
  - Git 로그와 문서(CHANGELOG/RETROSPECTIVE/AI_LOG)가 역할 정리가 안 된 상태.
- **조치 내용**
  - `CHANGELOG.md`, `RETROSPECTIVE.md`, `AI_LOG.md`에 **운영 원칙** 명시:
    - 커밋 메시지는 `feat: ...`, `fix: ...`처럼 **간략한 한 줄 요약**만 사용.
    - 자세한 변경 내역/이유/영향/컨텍스트는 문서 3곳에 분리 기록.
- **결과**
  - 독자는 Git 로그 대신 문서만 읽어도 개선 과정/의사결정 흐름을 명확히 이해할 수 있음.

---

## 6) 다안 비교 모드에서 프리셋 선택 시 값이 반영되지 않는 문제 (1차 시도)

- **증상**
  - 화면에서 "다안 비교 입력" 모드로 전환한 뒤,
  - 아래의 "예시 시나리오" 프리셋 버튼(마트/요리/배송 등)을 눌러도  
    다안 비교 입력 카드에는 값이 채워지지 않아, 계산이 되지 않음.
- **원인 가설**
  - 프리셋 클릭 핸들러가 항상 2안 비교 입력 필드만 채우도록 구현되어 있고,
  - `currentMode === 'multi'` 인 경우를 고려하지 않음.
- **조치 내용**
  - 프리셋 핸들러를 모드에 따라 분기:
    - 공통: 시급 입력 + 분당 가치 업데이트
    - 2안 비교 모드: 기존처럼 A/B 입력 필드에 프리셋 값 주입
    - 다안 비교 모드:
      - 필요 시 `initMultiOptions()`로 카드 초기화
      - 첫 번째 카드에 A, 두 번째 카드에 B 프리셋 값 주입
- **결과**
  - 1차 시도는 여전히 동작하지 않음.

---

## 7) 다안 비교 프리셋 값 주입 실패 (DOM 선택 방식 문제)

- **증상**
  - 다안 비교 모드로 전환 후 프리셋 버튼을 눌러도 여전히 입력 카드에 값이 채워지지 않음.
  - 계산 시도 시 "선택지 A의 모든 값을 입력해주세요" 에러 발생.
- **원인 가설**
  - 프리셋 핸들러에서 `document.querySelectorAll('.multi-option-card')`로 카드를 선택한 뒤,
  - `optionCards[0].querySelector('.multi-time-input')`로 카드 내부 input을 찾는 방식이 불안정함.
  - 동적 생성된 요소의 선택 타이밍이나 CSS 선택자 우선순위 문제 가능성.
- **조치 내용**
  - DOM 선택 방식 변경:
    - 카드를 거치지 않고, **`data-index` 속성을 직접 사용**하여 전역에서 입력 필드 선택
    - `document.querySelector('.multi-time-input[data-index="0"]')` 방식으로 명확히 지정
  - 에러 처리 강화:
    - 입력 필드를 찾지 못하면 "다안 비교 모드로 먼저 전환해주세요" 안내
  - 다안 비교 계산 시 입력 검증 강화:
    - 시급 검증 추가 (빈 문자열, NaN, 음수, 큰 값 경고)
    - 각 선택지별 입력 필드 존재 여부 체크
    - 숫자 변환 및 범위 검증 추가
    - 검증 실패 시 해당 입력 필드로 focus 이동
- **결과**
  - 다안 비교 모드에서 프리셋 버튼 정상 동작 확인.
  - data-index 기반 선택으로 더 명확하고 안정적인 DOM 접근.
  - 입력 검증이 강화되어 사용자에게 더 명확한 피드백 제공.

---

## 8) 에러 메시지 시인성 문제 (화면 하단에서 보이지 않음)

- **증상**
  - 입력 검증 실패 시 에러 메시지가 화면 하단(`#errorMessage` 영역)에 표시되는데,
  - 사용자가 상단 입력 필드를 보고 있으면 에러를 놓치기 쉬움.
  - 특히 모바일이나 긴 페이지에서는 스크롤을 내려야만 에러를 확인 가능.
- **원인 가설**
  - `showError()` 함수가 하단 영역에만 메시지를 표시하고,
  - 사용자의 현재 스크롤 위치를 고려하지 않음.
- **조치 내용 (1차)**
  - `showError()` 함수를 3단계로 개선:
    1. `alert()` 팝업으로 즉시 에러 내용 표시
    2. 하단 에러 메시지 영역도 유지
    3. `window.scrollTo()`로 상단 자동 스크롤
- **조치 내용 (2차 - 사용자 피드백 반영)**
  - alert가 너무 침습적(intrusive)이라는 피드백으로 제거
  - 최종 방식:
    1. 하단 에러 메시지 영역 표시 (빨간색, 눈에 띄게)
    2. `window.scrollTo({ top: 0, behavior: 'smooth' })`로 상단 자동 스크롤
  - 사용자가 메시지를 읽을 수 있도록 하면서도, 흐름을 중단하지 않음
- **결과**
  - 에러 발생 시 자동으로 상단 스크롤되어 에러 메시지 영역이 보임.
  - alert 없이도 충분히 눈에 띄고, 사용자 흐름을 방해하지 않음.

---

## 9) 다안 비교 프리셋에서 3개 이상 선택지가 채워지지 않는 문제

- **증상**
  - 다안 비교 모드에서 선택지가 3개, 4개, 5개일 때
  - 프리셋 버튼을 눌러도 A, B만 채워지고 C, D, E는 빈 값으로 남음.
  - 사용자가 수동으로 C, D, E를 입력해야 함.
- **원인 가설**
  - 프리셋 데이터 구조가 `optionA`, `optionB`만 가지고 있어서,
  - 3개 이상 선택지를 위한 데이터가 없음.
  - 프리셋 핸들러도 A, B만 채우도록 하드코딩되어 있음.
- **조치 내용**
  - 프리셋 데이터 구조 확장:
    - 기존 `optionA`, `optionB` 유지 (2안 비교 모드 호환성)
    - 새로운 `options` 배열 추가: 최대 5개 선택지 데이터 포함
    - 각 시나리오별로 의미 있는 5가지 옵션 정의
      - 예) 마트: 가까운 마트, 먼 마트, 중간 거리 마트, 편의점, 대형마트
  - 프리셋 핸들러 수정:
    - 다안 비교 모드일 때 `multiOptionCount`만큼 반복
    - `preset.options[i]`에서 순차적으로 값을 가져와 채움
    - 프리셋 데이터가 없는 인덱스는 빈 값으로 유지 (경고 로그)
- **결과**
  - 다안 비교 모드에서 3, 4, 5개 선택지 모두 프리셋으로 자동 채워짐.
  - 각 시나리오마다 의미 있는 다양한 옵션 제공.
  - 사용자가 즉시 계산을 실행할 수 있어 UX 크게 개선.

---

## 10) PowerShell에서 Git 커밋 heredoc 구문 오류

- **증상**
  - Git 커밋 시 heredoc(`$(cat <<'EOF' ... EOF)`) 구문을 사용하면,
  - PowerShell에서 `ParserError: InvalidEndOfLine` 오류 발생.
- **원인 가설**
  - PowerShell의 heredoc 구문은 Bash와 다름.
  - Git 명령을 PowerShell에서 실행할 때 구문 오류 발생.
- **조치 내용**
  - 커밋 메시지를 **간략한 한 줄 요약**으로 변경.
  - 상세한 내용은 문서(`CHANGELOG.md`, `RETROSPECTIVE.md`)에 기록.
  - 예) `feat: improve UX based on user feedback` (간략)
       → 상세 내용은 CHANGELOG에 표로 정리
- **결과**
  - 커밋 성공.
  - Git 로그는 깔끔하게 유지, 상세 내용은 문서에서 확인 가능.

---

## 11) Spring Boot 애플리케이션 포트 충돌 (8080 이미 사용 중)

- **증상**
  - `mvn spring-boot:run` 실행 시,
  - `Web server failed to start. Port 8080 was already in use.` 오류 발생.
- **원인**
  - 이전에 실행한 Spring Boot 프로세스가 종료되지 않고 백그라운드에서 실행 중.
- **조치 내용**
  - PowerShell에서 Java 프로세스 확인 및 종료:
    ```powershell
    Get-Process -Name java -ErrorAction SilentlyContinue | Stop-Process -Force
    ```
  - 3초 대기 후 재시작.
- **결과**
  - 포트 충돌 해결, 서버 정상 시작.

---

## 12) 캐시 동작 검증 및 로그 추적

- **증상**
  - 동일한 요청을 2번 보냈을 때, 두 번째 요청에서 캐시가 적중되는지 확인 필요.
  - 로그에 "캐시에서 반환" 메시지가 나오는지 불분명.
- **조치 내용**
  - `OpportunityCostService`의 `calculate()` 메서드에 로그 추가:
    ```java
    if (cached.isPresent()) {
        log.info("캐시된 결과 반환");
        return cached.get();
    }
    ```
  - 테스트 추가: `testCalculate_CacheWorks()`
    - 동일한 요청 2회 전송
    - 결과가 동일한지 확인
- **결과**
  - 캐시 정상 동작 확인.
  - 테스트 통과: 17/17 → 18/18.

---

## 13) sessionStorage 전환 후 히스토리 동작 확인

- **증상**
  - localStorage → sessionStorage 변경 후,
  - 실제로 탭을 닫았을 때 히스토리가 삭제되는지 확인 필요.
- **조치 내용**
  - 브라우저 테스트:
    1. 계산 여러 번 수행 → 히스토리 확인
    2. 탭 닫기 → 새 탭에서 다시 접속
    3. 히스토리가 비어있는지 확인
- **결과**
  - sessionStorage 정상 동작 확인.
  - 새 세션마다 깨끗한 시작 가능.

---

## 14) 매우 높은 시급 입력 시 부적절한 에러 메시지

- **증상**
  - 시급에 10억원 같은 매우 큰 값 입력 시,
  - "요청 형식이 올바르지 않습니다. JSON 형식을 다시 확인해주세요" 에러 발생.
  - 사용자 입장에서는 JSON을 직접 작성하지 않았으므로 혼란.
- **원인**
  - 백엔드에 `@Max` 검증이 없어, 매우 큰 값이 Long 범위를 초과하거나,
  - JavaScript Number의 안전 범위를 초과하여 JSON 직렬화 문제 발생 가능.
  - 프론트엔드에서는 `confirm`으로 경고만 하고 상한선 체크는 없음.
- **조치 내용**
  - **백엔드**: `@Max(value = 100_000_000)` 추가 (1억원 상한)
    - 메시지: "시급은 1억원 이하로 입력해주세요."
  - **프론트엔드**: 상한선 체크 추가
    ```javascript
    if (hourlyWage > 100000000) {
        showError('시급은 1억원 이하로 입력해주세요.');
        return false;
    }
    ```
  - **테스트 추가**: `testCalculate_ExceedsMaxWage()` (18번째 테스트)
- **결과**
  - 1억원 초과 입력 시 명확한 메시지: "시급은 1억원 이하로 입력해주세요."
  - 테스트 18/18 통과.
  - 프론트엔드와 백엔드 이중 검증으로 안정성 확보.

---

## 15) 브라우저 캐시로 인한 JavaScript 파일 미갱신

- **증상**
  - `app.js` 파일을 수정했는데, 브라우저에서 이전 버전이 로드됨.
  - F5 새로고침으로도 업데이트되지 않음.
- **원인**
  - 브라우저가 정적 리소스를 캐싱하여, 수정된 파일을 다시 요청하지 않음.
- **조치 내용**
  - `index.html`에서 JavaScript 참조에 버전 파라미터 추가:
    ```html
    <script th:src="@{/js/app.js(v=2)}"></script>
    ```
  - 파일 수정 시마다 버전 증가 (v=2, v=3, ...)
  - 또는 Ctrl+Shift+R (하드 리프레시) 안내
- **결과**
  - 수정된 JavaScript 파일이 즉시 반영됨.

---

## 16) Git 커밋 후 "LF will be replaced by CRLF" 경고

- **증상**
  - Git 커밋 시 다음 경고 반복 발생:
    ```
    warning: in the working copy of 'src/main/resources/static/js/app.js', LF will be replaced by CRLF the next time Git touches it
    ```
- **원인**
  - Windows 환경에서 Git이 자동으로 줄바꿈을 CRLF로 변환.
  - 파일이 LF로 되어있으면 경고 발생 (동작에는 영향 없음).
- **조치 내용**
  - **현재**: 경고 무시 (동작에 영향 없음)
  - **향후 개선 옵션**:
    - `.gitattributes` 파일로 줄바꿈 정책 통일
    - 또는 `git config core.autocrlf false`
- **결과**
  - 기능상 문제 없음. 경고는 무시 가능.

---

## 17) 사용자 테스트 전 서버 재시작 필요성

- **증상**
  - 코드 수정 후 사용자가 브라우저에서 테스트할 때,
  - 서버가 이미 실행 중이면 변경사항이 반영되지 않음.
- **원인**
  - Spring Boot 애플리케이션이 이미 실행 중이면 코드 변경이 반영 안 됨.
  - (spring-boot-devtools 없음)
- **조치 내용**
  - 코드 수정 후:
    1. Java 프로세스 종료: `Get-Process -Name java | Stop-Process -Force`
    2. 3초 대기
    3. 재시작: `mvn spring-boot:run`
  - 또는 spring-boot-devtools 추가 고려.
- **결과**
  - 사용자 테스트 시 최신 코드 반영 확인.
